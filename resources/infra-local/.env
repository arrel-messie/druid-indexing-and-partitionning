# ============================================
# Fichier de configuration centralisé
# Tous les paramètres d'environnement pour tous les services
# ============================================

# ============================================
# PostgreSQL Druid (Métadonnées)
# ============================================
POSTGRES_DRUID_USER=druid
POSTGRES_DRUID_PASSWORD=FoolishPassword
POSTGRES_DRUID_DB=druid
POSTGRES_DRUID_PORT=5432

# ============================================
# PostgreSQL Applicatif
# ============================================
POSTGRES_APP_USER=app_user
POSTGRES_APP_PASSWORD=app_password
POSTGRES_APP_DB=app_db
POSTGRES_APP_PORT=5433

# ============================================
# Druid Configuration
# ============================================
DRUID_SINGLE_NODE_CONF=micro-quickstart
DRUID_EMITTER_LOGGING_LOGLEVEL=debug
druid_extensions_loadList=["druid-histogram", "druid-datasketches", "druid-lookups-cached-global", "postgresql-metadata-storage", "druid-multi-stage-query", "druid-kafka-indexing-service", "druid-protobuf-extensions"]

druid_zk_service_host=zookeeper

DRUID_METADATA_STORAGE_TYPE=postgresql
DRUID_METADATA_STORAGE_CONNECTOR_CONNECTURI=jdbc:postgresql://postgres:5432/druid
DRUID_METADATA_STORAGE_CONNECTOR_USER=druid
DRUID_METADATA_STORAGE_CONNECTOR_PASSWORD=FoolishPassword

DRUID_INDEXER_RUNNER_JAVAOPTSARRAY=["-server", "-Xmx1g", "-Xms1g", "-XX:MaxDirectMemorySize=3g", "-Duser.timezone=UTC", "-Dfile.encoding=UTF-8", "-Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager"]
DRUID_INDEXER_FORK_PROPERTY_DRUID_PROCESSING_BUFFER_SIZEBYTES=256MiB

DRUID_STORAGE_TYPE=local
DRUID_STORAGE_STORAGEDIRECTORY=/opt/shared/segments
DRUID_INDEXER_LOGS_TYPE=file
DRUID_INDEXER_LOGS_DIRECTORY=/opt/shared/indexing-logs

DRUID_PROCESSING_NUMTHREADS=2
DRUID_PROCESSING_NUMMERGEBUFFERS=2

# Kafka indexing service configuration
DRUID_INDEXER_KAFKA_BOOTSTRAP_SERVERS=kafka:9093
DRUID_INDEXER_KAFKA_CONSUMER_PROPERTIES_BOOTSTRAP_SERVERS=kafka:9093

DRUID_LOG4J=<?xml version="1.0" encoding="UTF-8" ?><Configuration status="WARN"><Appenders><Console name="Console" target="SYSTEM_OUT"><PatternLayout pattern="%d{ISO8601} %p [%t] %c - %m%n"/></Console></Appenders><Loggers><Root level="info"><AppenderRef ref="Console"/></Root><Logger name="org.apache.druid.jetty.RequestLog" additivity="false" level="DEBUG"><AppenderRef ref="Console"/></Logger></Loggers></Configuration>

# ============================================
# Kafka Configuration
# ============================================
KAFKA_NODE_ID=1
KAFKA_PROCESS_ROLES=broker,controller
KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:9091
KAFKA_INTER_BROKER_LISTENER_NAME=DOCKER
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1
KAFKA_LOG_RETENTION_HOURS=168
KAFKA_LOG_SEGMENT_BYTES=1073741824
KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS=300000

# ============================================
# Schema Registry Configuration
# ============================================
SCHEMA_REGISTRY_HOST_NAME=schema-registry
SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=kafka:9093
SCHEMA_REGISTRY_LISTENERS=http://0.0.0.0:8081
SCHEMA_REGISTRY_KAFKASTORE_TOPIC=_schemas
SCHEMA_REGISTRY_KAFKASTORE_TOPIC_REPLICATION_FACTOR=1

# ============================================
# Flink Configuration
# ============================================
FLINK_JOBMANAGER_RPC_ADDRESS=flink-jobmanager
FLINK_TASKMANAGER_NUMBEROFTASKSLOTS=2
FLINK_PARALLELISM_DEFAULT=2

# ============================================
# ZooKeeper Configuration
# ============================================
ZOO_MY_ID=1
